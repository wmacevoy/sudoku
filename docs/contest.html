<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sudoku Contest Generator</title>
  <style>
    :root{
      --bg:#0b0c10;
      --panel:#0f141d;
      --ink:#e8ecf2;
      --muted:#91a0b6;
      --accent:#60a5fa;
      --grid:#1f2430;
      --paper:#ffffff;
    }
    *{box-sizing:border-box;}
    body{margin:0; font-family:"Inter", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); color:var(--ink); min-height:100vh; display:flex; flex-direction:column; gap:18px; padding:18px;}
    h1{margin:0 0 8px 0;}
    .controls{background:var(--panel); border:1px solid #111827; border-radius:12px; padding:14px; display:grid; gap:12px;}
    .row{display:flex; flex-wrap:wrap; gap:12px; align-items:flex-end;}
    label{font-size:13px; color:var(--muted); display:flex; flex-direction:column; gap:6px;}
    input[type="text"], input[type="number"]{background:var(--bg); color:var(--ink); border:1px solid var(--grid); border-radius:8px; padding:9px 10px; min-width:120px;}
    input[type="number"]{width:120px;}
    button{cursor:pointer; background:var(--accent); color:#0b0c10; border:1px solid var(--accent); border-radius:10px; padding:10px 16px; font-weight:700;}
    button.secondary{background:transparent; color:var(--ink); border-color:var(--grid);}
    .status{font-size:13px; color:var(--muted);}
    #print-area{background:var(--paper); color:#000; border-radius:12px; padding:12px; box-shadow:0 10px 28px rgba(0,0,0,0.4); display:block;}
    .page{
      display:block;
      margin:0 0 16px 0;
      padding:12px;
      border:1px solid #e2e8f0;
      border-radius:10px;
      background:#fff;
      color:#000;
      page-break-after:always;
      break-after:page;
      break-inside:avoid-page;
      page-break-inside:avoid;
      -webkit-region-break-inside:avoid;
      -webkit-column-break-inside:avoid;
    }
    .page + .page{
      break-before:page;
      page-break-before:always;
    }
    .page:last-child{page-break-after:auto;}
    .page h2{margin:0 0 12px 0; font-size:20px; text-align:center;}
    .p-grid{display:grid; grid-template-columns:repeat(9,1fr); grid-template-rows:repeat(9,1fr); width:100%; max-width:900px; aspect-ratio:1/1; border:0.6mm solid #000; margin:0 auto; background:#fff;}
    .p-cell{border:0.12mm solid rgba(0,0,0,0.45); position:relative; display:flex; align-items:center; justify-content:center; font-size:64px; font-weight:700; min-height:64px;}
    .p-cell[data-row="1"], .p-cell[data-row="4"], .p-cell[data-row="7"]{border-top:0.6mm solid #000;}
    .p-cell[data-col="1"], .p-cell[data-col="4"], .p-cell[data-col="7"]{border-left:0.6mm solid #000;}
    .p-cell[data-col="9"]{border-right:0.6mm solid #000;}
    .p-cell[data-row="9"]{border-bottom:0.6mm solid #000;}
    .puzzle-meta{display:flex; justify-content:space-between; align-items:center; font-size:13px; margin:0 auto 10px auto; max-width:900px;}
    .keys-title{margin:16px 0 8px 0; font-size:16px; font-weight:700; text-align:center;}
    .page-footer{margin-top:10px; font-size:12px; text-align:center; color:#444;}
    @media print{
      @page { margin:12mm; }
      body{background:#fff; padding:0;}
      .controls{display:none !important;}
      #print-area{box-shadow:none; border-radius:0; padding:0;}
      .page{
        border:0;
        border-radius:0;
        padding:12px 10px 16px 10px;
        page-break-after:always;
        break-after:page;
        break-inside:avoid-page;
        page-break-inside:avoid;
        -webkit-region-break-inside:avoid;
        -webkit-column-break-inside:avoid;
      }
      .page:last-child{page-break-after:auto;}
      .page + .page{
        break-before:page;
        page-break-before:always;
      }
    }
  </style>
</head>
<body>
  <div class="controls">
    <div>
      <h1>Sudoku Contest Generator</h1>
      <div class="status" id="status">Set counts, generate, then print.</div>
    </div>
    <div class="row">
      <label>Contest title
        <input id="contest-title" type="text" value="Sudoku" />
      </label>
      <label>Simple puzzles (max 26)
        <input id="count-simple" type="number" min="0" max="26" value="0" />
      </label>
      <label>Copies each
        <input id="copies-simple" type="number" min="1" max="99" value="1" />
      </label>
    </div>
    <div class="row">
      <label>Easy puzzles (max 26)
        <input id="count-easy" type="number" min="0" max="26" value="2" />
      </label>
      <label>Copies each
        <input id="copies-easy" type="number" min="1" max="99" value="20" />
      </label>
    </div>
    <div class="row">
      <label>Medium puzzles (max 26)
        <input id="count-medium" type="number" min="0" max="26" value="2" />
      </label>
      <label>Copies each
        <input id="copies-medium" type="number" min="1" max="99" value="20" />
      </label>
    </div>
    <div class="row">
      <label>Hard puzzles (max 26)
        <input id="count-hard" type="number" min="0" max="26" value="1" />
      </label>
      <label>Copies each
        <input id="copies-hard" type="number" min="1" max="99" value="10" />
      </label>
    </div>
    <div class="row">
      <button id="btn-generate">Generate puzzles</button>
      <button id="btn-print" class="secondary">Print</button>
      <button id="btn-practice" type="button" class="secondary" onclick="window.location.href='index.html'">Practice</button>
    </div>
  </div>

  <div id="print-area" aria-live="polite"></div>

  <script type="module">
    import { SudokuEngine, DIGITS } from './sudoku-engine.js';

    const engine = new SudokuEngine();
    const el = (id) => document.getElementById(id);
    const statusEl = el('status');
    const printArea = el('print-area');
    const titleInput = el('contest-title');
    const inputs = {
      simple: { count: el('count-simple'), copies: el('copies-simple'), label: 'Simple' },
      easy: { count: el('count-easy'), copies: el('copies-easy'), label: 'Easy' },
      medium: { count: el('count-medium'), copies: el('copies-medium'), label: 'Medium' },
      hard: { count: el('count-hard'), copies: el('copies-hard'), label: 'Hard' }
    };

    function clampInt(val, min, max, fallback) {
      const n = Number(val);
      if (!Number.isFinite(n)) return fallback;
      return Math.min(Math.max(Math.floor(n), min), max);
    }

    function gridHTML(board) {
      return board
        .map((row, r) =>
          row
            .map((val, c) => {
              const content = val === 0 ? '' : val;
              return `<div class="p-cell" data-row="${r + 1}" data-col="${c + 1}">${content}</div>`;
            })
            .join('')
        )
        .join('');
    }

    function generateContest() {
      const title = titleInput.value.trim() || 'Sudoku';
      const specs = Object.entries(inputs).map(([diff, cfg]) => {
        const count = clampInt(cfg.count.value, 0, 26, 0);
        const copies = clampInt(cfg.copies.value, 1, 99, 1);
        cfg.count.value = String(count);
        cfg.copies.value = String(copies);
        return { diff, label: cfg.label, count, copies };
      });

      const puzzles = [];
      for (const spec of specs) {
        const capped = Math.min(spec.count, 26);
        for (let i = 0; i < capped; i++) {
          const puzzle = engine.createPuzzle(spec.diff);
          const solved = engine.solve(puzzle);
          if (solved.status !== 'unique' || !solved.solution) {
            i--;
            continue;
          }
          const letter = String.fromCharCode(65 + i); // A-Z
          puzzles.push({
            diff: spec.diff,
            diffLabel: spec.label,
            letter,
            puzzle,
            solution: solved.solution,
            copies: spec.copies
          });
        }
      }

      if (!puzzles.length) {
        statusEl.textContent = 'No puzzles requested.';
        printArea.innerHTML = '';
        return;
      }

      const blocks = [];
      for (const p of puzzles) {
        for (let copy = 1; copy <= p.copies; copy++) {
          blocks.push(`
            <div class="page">
              <h2>${title}: Copy ${copy} of ${p.diffLabel} Puzzle ${p.letter}</h2>
              <div class="puzzle-meta">
                <div>${p.diffLabel}</div>
                <div>Puzzle ${p.letter}</div>
              </div>
              <div class="p-grid">${gridHTML(p.puzzle)}</div>
              <div class="page-footer">No QR codes. One puzzle per page.</div>
            </div>
          `);
        }
      }

      for (const p of puzzles) {
        blocks.push(`
          <div class="page">
            <h2>${title}: KEY of ${p.diffLabel} Puzzle ${p.letter}</h2>
            <div class="puzzle-meta">
              <div>${p.diffLabel}</div>
              <div>Solution</div>
            </div>
            <div class="p-grid">${gridHTML(p.solution)}</div>
          </div>
        `);
      }

      printArea.innerHTML = blocks.join('');
      statusEl.textContent = `Generated ${puzzles.length} puzzles across ${puzzles.reduce((sum,p)=>sum+p.copies,0)} copies. Ready to print.`;
    }

    document.getElementById('btn-generate').addEventListener('click', generateContest);
    document.getElementById('btn-print').addEventListener('click', () => {
      if (!printArea.innerHTML.trim()) generateContest();
      window.print();
    });
  </script>
</body>
</html>

